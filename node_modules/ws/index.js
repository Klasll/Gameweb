const express = require("express");
const path = require("path");
const WebSocket = require("ws");

const app = express();
const PORT = process.env.PORT || 10000;

// 1. Statische Frontend-Dateien bereitstellen
// Pfad zum Build-Ordner deines Frontends (z.B. "gameweb-frontend/dist" nach Vite build)
app.use(express.static(path.join(__dirname, "public")));

// 2. Alle anderen Anfragen an Frontend index.html schicken (fÃ¼r SPA Routing)
app.get("*", (req, res) => {
  res.sendFile(path.join(__dirname, "public", "index.html"));
});

// 3. HTTP Server starten
const server = app.listen(PORT, () => {
  console.log(`âœ… Server lÃ¤uft auf Port ${PORT}`);
});

// 4. WebSocket Server an HTTP Server anhÃ¤ngen
const wss = new WebSocket.Server({ server });

wss.on("connection", (ws) => {
  console.log("ğŸŸ¢ WebSocket Verbindung aufgebaut");

  ws.on("message", (message) => {
    console.log(`Nachricht vom Client: ${message}`);

    // Beispiel: Echo zurÃ¼ck an Client
    ws.send(`Server sagt: ${message}`);
  });

  ws.on("close", () => {
    console.log("ğŸ”´ WebSocket Verbindung geschlossen");
  });
});
